<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Generating DLLs and their Use in Applications | CMake Template Projects</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Generating DLLs and their Use in Applications" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Welcome Back, Let’s build Dynamic Link Library (DLL)" />
<meta property="og:description" content="Welcome Back, Let’s build Dynamic Link Library (DLL)" />
<link rel="canonical" href="https://vsphaneendrapaluri.github.io/cmakeforneophytes/demo-example-template/2019/08/20/06-build-and-load-shared-dlls.html" />
<meta property="og:url" content="https://vsphaneendrapaluri.github.io/cmakeforneophytes/demo-example-template/2019/08/20/06-build-and-load-shared-dlls.html" />
<meta property="og:site_name" content="CMake Template Projects" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-20T19:52:00+05:30" />
<script type="application/ld+json">
{"headline":"Generating DLLs and their Use in Applications","dateModified":"2019-08-20T19:52:00+05:30","datePublished":"2019-08-20T19:52:00+05:30","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://vsphaneendrapaluri.github.io/cmakeforneophytes/demo-example-template/2019/08/20/06-build-and-load-shared-dlls.html"},"url":"https://vsphaneendrapaluri.github.io/cmakeforneophytes/demo-example-template/2019/08/20/06-build-and-load-shared-dlls.html","description":"Welcome Back, Let’s build Dynamic Link Library (DLL)","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cmakeforneophytes/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://vsphaneendrapaluri.github.io/cmakeforneophytes/feed.xml" title="CMake Template Projects" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cmakeforneophytes/">CMake Template Projects</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/cmakeforneophytes/home/home.html">Start-Here</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Generating DLLs and their Use in Applications</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-08-20T19:52:00+05:30" itemprop="datePublished">Aug 20, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="welcome-back-lets-build-dynamic-link-library-dll">Welcome Back, Let’s build Dynamic Link Library (DLL)</h1>

<p>As one might understand, the concept of STATIC libraries and SHARED DLLs is completely different.  Just to mention, explaining the differences between the two libraries is NOT within the scope of this page.</p>

<p>The object is to get to build DLL target and use (load) them later in an application (an executable).</p>

<h2 id="some-information-related-to-dll-library-sources-from-the-current-demo">Some Information related to DLL Library Sources from the Current Demo</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
#ifdef HELPER_ALGO_EXPORTS
#define HELPER_ALGO_EXPORT_DLL __declspec(dllexport)
#else
#define HELPER_ALGO_EXPORT_DLL __declspec(dllimport)
#endif

class HELPER_ALGO_EXPORT_DLL HelperAlgorithms
{
  public:
  
    // Set of Interface APIs that are exported
};
</code></pre></div></div>

<h2 id="rules-for-creating-dll-and-exporting-an-interface">Rules for Creating DLL and Exporting an Interface</h2>

<p>As we could see from the above code snippet, <em>HELPER_ALGO_EXPORTS</em> control when interface is exported and when it can be imported.</p>

<p>To create the DLL of HelperAlgorithms, user needs to define <code class="highlighter-rouge">HELPER_ALGO_EXPORTS</code>.  It would enable <code class="highlighter-rouge">__declspec(dllexport)</code> which specifies the compiler to export the interface.</p>

<p>The following listfile instruction demonstrate how it is done.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add_library(
  ${PROJECT_NAME}
  SHARED
  ${&lt;list_of_sources&gt;}
)

target_compile_options(
  ${PROJECT_NAME}
  PRIVATE
  -D HELPER_ALGO_EXPORTS
)

target_include_directories(
  ${PROJECT_NAME}
  PUBLIC
  ${&lt;list_of_exported_headers&gt;}
)
</code></pre></div></div>

<p><code class="highlighter-rouge">SHARED</code> keyword sets the earlier discussed CMake in-built variable <em>BUILD_SHARED_LIBS</em> is set to <em>true</em> or <em>ON</em></p>

<p>Also, one could easily notice that the CMake command <code class="highlighter-rouge">target_compile_options</code> supports the language constructs such as PUBLIC, SHARED and INTERFACE type.  The basic definition for the usage of these language constructs is the same.</p>

<p>Within the current example, the compile time option parameter has been set to PRIVATE since this pre-processor directive is required only by the current target (DLL).</p>

<h2 id="rules-for-linking-against-dll-and-importing-interfaces">Rules for Linking against DLL and Importing Interface(s)</h2>

<p>Rules for linking DLL to the application are no different to what we have witnessed with the earlier example.</p>

<p>Here, the application that requires to use these interfaces, needs to load this DLL first.  Also, the application MUST NOT TO DEFINE the <em>HELPER_ALGO_EXPORTS</em> since, it is the one that wants to import these services provided by the DLL.  Compiling the target (application) sources WITHOUT defining the <em>preprocessor</em> enables <code class="highlighter-rouge">__declspec(dllimport)</code> which indicates to the compiler that the requested interfaces are available within the loaded DLL.</p>

<p>The only other new CMake command that user would notice in the application listfile is <code class="highlighter-rouge">add_custom_command</code>.</p>

<p>Syntax is as shown below</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add_custom_command(
  TARGET ${PROJECT_NAME} POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E copy
  ${CMAKE_SOURCE_DIR}/build/sources/Debug/HelperAlgorithms.dll
  ${CMAKE_SOURCE_DIR}/build/tests/Debug/
)
</code></pre></div></div>

<p>Note that since this is a <em>custom CMake command</em> that needs to run POST BUILD, hence, it needs to be mentioned only after setting up the target.  In this case, this custom command is used to copy the DLL built at it’s default location and copy it to the location where the final executable is expected to be located.  So, that when application is executed, the application target finds the DLL alongside it.</p>

<p>That’s it !!</p>

<p>We haven’t learnt the most efficient of dealing with DLLs on Windows yet, but the actual scope of this demonstration was to showcase the action of SHARED in DLL creation.</p>

<hr />

<h3 id="id-definitely-be-interested-in-writing-an-another-small-template-that-highlights-few-new-features-that-have-been-introduced-in-cmake-34-which-have-enabled-the-efficiency-of-dll-creation-on-windows-at-least">I’d definitely be interested in writing an another small template that highlights few new features that have been introduced in CMake 3.4 which have enabled the efficiency of DLL creation on Windows at-least.</h3>

  </div><a class="u-url" href="/cmakeforneophytes/demo-example-template/2019/08/20/06-build-and-load-shared-dlls.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cmakeforneophytes/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">CMake Template Projects</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">CMake Template Projects</li><li><a class="u-email" href="mailto:pvs.myworks@gmail.com">pvs.myworks@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/vsphaneendrapaluri"><svg class="svg-icon"><use xlink:href="/cmakeforneophytes/assets/minima-social-icons.svg#github"></use></svg> <span class="username">vsphaneendrapaluri</span></a></li><li><a href="https://www.twitter.com/pvsphaneendra"><svg class="svg-icon"><use xlink:href="/cmakeforneophytes/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">pvsphaneendra</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This work is aimed to help the first-time users of CMake tool to get started fast. This project provides basic introductory documentation, CMake template project for often encountered use-case scenari, etcetera.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
